## System tests

System tests run a sample EDC connector with the Identity Hub extension and a DID server with sample DID documents for the connector and an external authority using docker. The test checks the correct functioning of the Identity Hub CLI together with the CredentialsVerifier.

An instance of `CredentialsVerifier` is injected in the test (hence the `@ExtendWith(EdcExtension.class)` annotation), to verify that another EDC connector is able to retrieve credentials from the Identity Hub after these have been added using the CLI.

#### Local test resources

Following test resources are provided in order to run system tests:

- A set of Private and Public keys for both the external authority and the EDC connector (identity hub owner) e.g. `system-tests/resources/jwt/authority`.

    ```bash
    # generate a private key
    openssl ecparam -name prime256v1 -genkey -noout -out private-key.pem
    # generate corresponding public key
    openssl ec -in private-key.pem -pubout -out public-key.pem
    ```
- Web DIDs are available under `system-tests/resources/webdid` folder. The `publicKeyJwk` section of each `did.json` was generated by converting the corresponding public key to JWK format, for example the authority public key was converted to JWK using following command:

    ```bash
    docker run -i danedmunds/pem-to-jwk:1.2.1 --public --pretty < system-tests/tests/resources/jwt/participant/public-key.pem
    ```

## Running tests locally 

Build launcher for system tests
```bash
./gradlew :system-tests:launcher:build
```

Run test components with:

```bash
docker-compose -f system-tests/tests/docker-compose.yml up --build
```

Run test with:

```bash
INTEGRATION_TEST=true ./gradlew :system-tests:tests:test
```